schema: '2.0'
stages:
  train_aqueous:
    cmd: python3 scripts/train_aqueous.py
    deps:
    - path: data/AqueousSolu.csv
      md5: a971c59bbbee6dbe768d3bdb60c7f7f6
      size: 2415802
    - path: scripts/aqueous_config.json
      hash: md5
      md5: 66f47df394ae6d8503d09515aac74604
      size: 224
    - path: scripts/train_aqueous.py
      hash: md5
      md5: eaf16b78e9f121955e7ef92896e272f7
      size: 2662
    - path: src/dataloader.py
      hash: md5
      md5: c78dea881a7a20d636ebbfed2a740f19
      size: 14418
    - path: src/model.py
      hash: md5
      md5: fac78b8d4e90126a943cea6cffe23015
      size: 23302
    outs:
    - path: results/aqueous/models/
      hash: md5
      md5: 5958776518eb1ec667c1fbedce0ea163.dir
      size: 309150
      nfiles: 3
  plot_aqueous:
    cmd: python3 scripts/explain_aqueous.py
    deps:
    - path: data/AqueousSolu.csv
      md5: a971c59bbbee6dbe768d3bdb60c7f7f6
      size: 2415802
    - path: results/aqueous/models/
      hash: md5
      md5: 5958776518eb1ec667c1fbedce0ea163.dir
      size: 309150
      nfiles: 3
    - path: scripts/aqueous_config.json
      hash: md5
      md5: 66f47df394ae6d8503d09515aac74604
      size: 224
    - path: scripts/explain_aqueous.py
      hash: md5
      md5: a0c83ba0da650697f3c4d4a1b0cdc66d
      size: 5682
    - path: src/dataloader.py
      hash: md5
      md5: c78dea881a7a20d636ebbfed2a740f19
      size: 14418
    - path: src/model.py
      hash: md5
      md5: fac78b8d4e90126a943cea6cffe23015
      size: 23302
    outs:
    - path: results/aqueous/viz/
      hash: md5
      md5: 81964e9504e973d1a118c38431454c42.dir
      size: 56031866
      nfiles: 1171
  predict_aqueous:
    cmd: python3 scripts/predict_aqueous.py
    deps:
    - path: data/AqueousSolu.csv
      md5: a971c59bbbee6dbe768d3bdb60c7f7f6
      size: 2415802
    - path: results/aqueous/models/
      hash: md5
      md5: 6d3dcf4d6bff9e3d422e61d6982fc202.dir
      size: 944065298
      nfiles: 7
    - path: scripts/aqueous_config.json
      hash: md5
      md5: b95d1100d38e9ba4aa1bbcd3f268a059
      size: 227
    - path: scripts/predict_aqueous.py
      hash: md5
      md5: 70cbf54a4802d4b8cc49c5b69052b98a
      size: 3097
    - path: src/dataloader.py
      hash: md5
      md5: 22dbac31abf08d1f115bcf176d14aca5
      size: 14019
    - path: src/model.py
      hash: md5
      md5: ad6282bdc4a676d392e21749e6229c9d
      size: 23301
    outs:
    - path: results/aqueous/AqueousSolu_predictions.csv
      hash: md5
      md5: 305770ec55ebb07ab7a47d0d711ec6d9
      size: 5200032
  aqueous:
    cmd: echo "Finished full aqueous solubility pipeline"
    deps:
    - path: results/aqueous/AqueousSolu_predictions.csv
      hash: md5
      md5: 2df2dc9267963edf1b991e6aa962a808
      size: 5126643
    - path: results/aqueous/models/
      hash: md5
      md5: 4fe432db7302f9c9897df33944594d11.dir
      size: 2828979740
      nfiles: 12
    - path: results/aqueous/viz/
      hash: md5
      md5: 12f3e38a70d4972a916c690077352226.dir
      size: 80450038
      nfiles: 1722
  train_combi:
    cmd: python3 scripts/train_combi.py
    deps:
    - path: data/CombiSolu-Exp.csv
      md5: b249b75582a9ca5e7a374648b81993be
      size: 1623266
    - path: scripts/combi_config.json
      md5: c16f95d9d61dff44470face9e47952ac
      size: 123
    - path: scripts/train_combi.py
      md5: 28c24006da34b1bc755765c628a325f7
      size: 1899
    - path: src/dataloader.py
      md5: 93db22cf89b1216e0372a8c1987de690
      size: 7477
    - path: src/model.py
      md5: dd61320f74f218659e501d58e46ef4f2
      size: 13068
    outs:
    - path: results/combi/models/
      md5: 49d97cb1b6c7c7909b63f212eddd991d.dir
      size: 235939805
      nfiles: 2
  plot_combi:
    cmd: python3 scripts/explain_combi.py
    deps:
    - path: data/CombiSolu-Exp.csv
      md5: b249b75582a9ca5e7a374648b81993be
      size: 1623266
    - path: results/combi/models/
      md5: 49d97cb1b6c7c7909b63f212eddd991d.dir
      size: 235939805
      nfiles: 2
    - path: scripts/combi_config.json
      md5: c16f95d9d61dff44470face9e47952ac
      size: 123
    - path: scripts/explain_combi.py
      md5: e8179f9e59c2381bc18703d741e881ab
      size: 5001
    - path: src/dataloader.py
      md5: 93db22cf89b1216e0372a8c1987de690
      size: 7477
    - path: src/model.py
      md5: dd61320f74f218659e501d58e46ef4f2
      size: 13068
    outs:
    - path: results/combi/viz/
      md5: 5e1fb28bb5fa0312af78438394adf8ff.dir
      size: 29300564
      nfiles: 494
  combi:
    cmd: echo "Finished full combi solubility pipeline"
    deps:
    - path: results/combi/models/
      md5: 49d97cb1b6c7c7909b63f212eddd991d.dir
      size: 235939805
      nfiles: 2
    - path: results/combi/viz/
      md5: 5e1fb28bb5fa0312af78438394adf8ff.dir
      size: 29300564
      nfiles: 494
  train_shap:
    cmd: python3 scripts/train_aqueous.py
    deps:
    - path: data/AqueousSolu.csv
      md5: a971c59bbbee6dbe768d3bdb60c7f7f6
      size: 2415802
    - path: scripts/aqueous_config.json
      md5: ad60becfccc50a2cd9761056997aeafb
      size: 119
    - path: scripts/train_aqueous.py
      md5: c6a4179a1a6007b93ef420b9a00568c1
      size: 1970
    - path: src/dataloader.py
      md5: 93db22cf89b1216e0372a8c1987de690
      size: 7477
    - path: src/model.py
      md5: 7e5343a96d7684960206ec2c277c8c70
      size: 14260
    outs:
    - path: results/shap/models/
      md5: efa6710e3112aebc873601e15a39a20f.dir
      size: 235939037
      nfiles: 1
  shap:
    cmd: echo "Finished full SHAP aqueous solubility pipeline"
    deps:
    - path: results/shap/models/
      md5: efa6710e3112aebc873601e15a39a20f.dir
      size: 235939037
      nfiles: 1
    - path: results/shap/viz/
      md5: bcfa35117ce3dc3b5d56a8c4b349c04a.dir
      size: 27310046
      nfiles: 574
  plot_shap:
    cmd: python3 scripts/explain_shap.py
    deps:
    - path: data/AqueousSolu.csv
      md5: a971c59bbbee6dbe768d3bdb60c7f7f6
      size: 2415802
    - path: results/shap/models/
      md5: efa6710e3112aebc873601e15a39a20f.dir
      size: 235939037
      nfiles: 1
    - path: scripts/explain_shap.py
      md5: a642fa70b3c13245c4e832c004f89104
      size: 4514
    - path: src/explainer.py
      md5: f8c2026326c3139ef120cfbd79c5f6fe
      size: 6419
    - path: src/model.py
      md5: 7e5343a96d7684960206ec2c277c8c70
      size: 14260
    outs:
    - path: results/shap/viz/
      md5: bcfa35117ce3dc3b5d56a8c4b349c04a.dir
      size: 27310046
      nfiles: 574
  train_logp:
    cmd: python3 scripts/train_logp.py
    deps:
    - path: data/opera_logp.csv
      md5: 2b10b2d996b900b9fb9027a78b736853
      size: 1372348
    - path: scripts/logp_config.json
      md5: aafe4564dfa9e70d14653161dc93f341
      size: 100
    - path: scripts/train_logp.py
      md5: 1ea7f4ea03a3afa3ff1102dd933cd8c3
      size: 1906
    - path: src/model.py
      md5: 7e5343a96d7684960206ec2c277c8c70
      size: 14260
    - path: src/prop_loader.py
      md5: 06ce4fcf7cba3571ce0a62b313e4d599
      size: 1984
    outs:
    - path: results/logp/models/
      md5: b63c8f9ba5e97833e1427452153539c9.dir
      size: 471878074
      nfiles: 2
  plot_logp:
    cmd: python3 scripts/explain_logp.py
    deps:
    - path: data/opera_logp.csv
      md5: 2b10b2d996b900b9fb9027a78b736853
      size: 1372348
    - path: results/logp/models/
      md5: b63c8f9ba5e97833e1427452153539c9.dir
      size: 471878074
      nfiles: 2
    - path: scripts/explain_logp.py
      md5: 1e50bad7188de0a169be4a25cceda5a6
      size: 7468
    - path: scripts/logp_config.json
      md5: aafe4564dfa9e70d14653161dc93f341
      size: 100
    - path: src/explainer.py
      md5: 178193b2961e9cce86bc8fee08a19514
      size: 6829
    - path: src/model.py
      md5: 7e5343a96d7684960206ec2c277c8c70
      size: 14260
    - path: src/prop_loader.py
      md5: 06ce4fcf7cba3571ce0a62b313e4d599
      size: 1984
    outs:
    - path: results/logp/logp_predictions.csv
      md5: 31ffcf88fc0de56856327ddc86177b4f
      size: 2115034
    - path: results/logp/viz_crippen/
      md5: e694658da9480e3726973930e73a5bef.dir
      size: 36029637
      nfiles: 731
    - path: results/logp/viz_ours/
      md5: 595462959f6bf37f6d1d668c6ee496b2.dir
      size: 35751902
      nfiles: 731
  logp:
    cmd: echo "Finished full logP + crippen explainability pipeline"
    deps:
    - path: results/logp/models/
      md5: 92611c76440c2b9dd87e6438b58091c6.dir
      size: 471878074
      nfiles: 2
    - path: results/logp/viz_crippen/
      md5: 1c30afed6ba264e835c8df03facc725d.dir
      size: 23100055
      nfiles: 731
    - path: results/logp/viz_ours/
      md5: 03486896f91aefb80d9b0de9fb735e48.dir
      size: 23053456
      nfiles: 731
  shap_logp:
    cmd: python3 scripts/explain_shap_logp.py
    deps:
    - path: data/logp_dataset.csv
      md5: 75b14bb0a736a67a5f89508e8420c415
      size: 246951
    - path: results/logp/models/
      md5: 6a65348a8355a84575341a55ecd13fcb.dir
      size: 707817111
      nfiles: 3
    - path: scripts/explain_shap_logp.py
      md5: ea261e35ed9c3d26616dc8514cd76697
      size: 4463
    - path: scripts/logp_config.json
      md5: f7de1a7f5cefe925558db9f4ec6c013b
      size: 100
    - path: src/explainer.py
      md5: dd65fb3ccd43f56d3a95a98dc60899fe
      size: 6821
    - path: src/model.py
      md5: 7e5343a96d7684960206ec2c277c8c70
      size: 14260
    - path: src/prop_loader.py
      md5: 27f739a707f74622a13a5b04fe4dc5a4
      size: 1907
    outs:
    - path: results/logp/logp_shap_predictions.csv
      md5: 801fd61211205905cbd3ae940abba0ff
      size: 148871
    - path: results/logp/viz_shap/
      md5: f7979bc24ae772c2a60c8e353f5cf323.dir
      size: 23288533
      nfiles: 730
  train_cmc:
    cmd: python3 scripts/train_cmc.py
    deps:
    - path: data/cmc_dataset_1235.csv
      md5: fdef3b6e89bff73a93f9501b73d5a49a
      size: 558577
    - path: scripts/cmc_config.json
      md5: cfa9016dcbbb66c7064ec004b7a20288
      size: 97
    - path: scripts/train_cmc.py
      md5: 0414cab9f181f686b44983b82316e0ba
      size: 1978
    - path: src/model.py
      md5: e4b80e905dc13b2d4750d823b83073da
      size: 14598
    - path: src/prop_loader.py
      md5: 8954c0f62ea4396f044b6beee336d981
      size: 2159
    outs:
    - path: results/cmc/models/
      md5: b6a7d7b25c269abbd83eeb0af8c7c967.dir
      size: 1649743563
      nfiles: 7
  plot_cmc:
    cmd: python3 scripts/explain_cmc.py
    deps:
    - path: data/cmc_dataset_1235.csv
      md5: fdef3b6e89bff73a93f9501b73d5a49a
      size: 558577
    - path: results/cmc/models/
      hash: md5
      md5: b6a7d7b25c269abbd83eeb0af8c7c967.dir
      size: 1649743563
      nfiles: 7
    - path: scripts/cmc_config.json
      hash: md5
      md5: cfa9016dcbbb66c7064ec004b7a20288
      size: 97
    - path: scripts/explain_cmc.py
      hash: md5
      md5: cbcf1de9093a7d25398980be8c3dadbd
      size: 7537
    - path: src/explainer.py
      md5: 178193b2961e9cce86bc8fee08a19514
      size: 6829
    - path: src/model.py
      hash: md5
      md5: e4b80e905dc13b2d4750d823b83073da
      size: 14598
    - path: src/prop_loader.py
      md5: 8954c0f62ea4396f044b6beee336d981
      size: 2159
    outs:
    - path: results/cmc/cmc_predictions.csv
      hash: md5
      md5: 663adddd2382632531939574e3ad743c
      size: 352666
    - path: results/cmc/viz_ours/
      hash: md5
      md5: 79bf5754d341f78fb22c6c2963628cbf.dir
      size: 4913998
      nfiles: 115
  aq:
    cmd: echo "Finished full aqueous solubility pipeline"
    deps:
    - path: out/aq/accurate/
      hash: md5
      md5: 064953f982ca98c67b9b5ac7ff181dec.dir
      size: 27071668
      nfiles: 578
    - path: out/aq/accurate/mmb-hier/best.pt
      hash: md5
      md5: a27bbdd3a56f5378ac83d52c5b6d07a9
      size: 154575
    - path: out/aq/accurate/mmb-hier/viz
      hash: md5
      md5: 68615c9d10b9b3bf980ca75fab540b2b.dir
      size: 26105388
      nfiles: 571
  split_data:
    cmd:
    - pwd
    - echo "SPLIT DATA --task aq --property aq --loader AqSolDataset --filepath /workspace/data/AqueousSolu.csv
      --propname logS_aq_avg --smilesname 'smiles solute' --plot_title 'Aqueous solubility'
      --plot_propname 'log(S)' --split scaffold --n_splits 5 --split_frac 0.9 --data_seed
      42 --scaffold_k 3 --color b --scale"
    - mkdir -p data/aq/scaffold/
    - python3 scripts/split_data.py
    deps:
    - path: scripts/split_data.py
      hash: md5
      md5: ef207805679def351f00edeeb7c61b59
      size: 3022
    - path: src/dataloader.py
      hash: md5
      md5: a7c3aad7e1dcd95cb7e93d48b7a21835
      size: 23030
    params:
      params.yaml:
        split:
          split: scaffold
          n_splits: 5
          split_frac: 0.9
          data_seed: 42
          scaffold_k: 3
          color: b
          scale: true
        task:
          task: aq
          property: aq
          loader: AqSolDataset
          filepath: /workspace/data/AqueousSolu.csv
          propname: logS_aq_avg
          smilesname: smiles solute
          plot_title: Aqueous solubility
          plot_propname: log(S)
    outs:
    - path: data/aq/scaffold/
      hash: md5
      md5: 41780c8f2998975cb8dd67a1be3caeec.dir
      size: 3027946
      nfiles: 12
  train_model:
    cmd:
    - mkdir -p out/aq/scaffold/ecfp2k-sverad/{viz,model}
    - echo "TRAIN --model ecfp2k --nbits 2048 --n_batch 64 --seed 42 --n_epochs 1
      --head sverad --fit sklearn"
    - python3 scripts/train_sklearn.py
    deps:
    - path: data/aq/scaffold/
      hash: md5
      md5: 41780c8f2998975cb8dd67a1be3caeec.dir
      size: 3027946
      nfiles: 12
    - path: scripts/train_model.py
      hash: md5
      md5: a1406a875de568a8c1a85683dc0be566
      size: 7303
    - path: scripts/train_sklearn.py
      hash: md5
      md5: 2b78e94fc83168e2ffc6f7b05e22fb93
      size: 4452
    - path: src/model.py
      hash: md5
      md5: 72ec74221911f70e60259a624f3b3e4d
      size: 23484
    params:
      params.yaml:
        head:
          head: sverad
          fit: sklearn
        model:
          model: ecfp2k
          nbits: 2048
          finetune: false
          n_batch: 64
          seed: 42
          n_epochs: 1
        split:
          split: scaffold
          n_splits: 5
          split_frac: 0.9
          data_seed: 42
          scaffold_k: 3
          color: b
          scale: true
        task:
          task: aq
          property: aq
          loader: AqSolDataset
          filepath: /workspace/data/AqueousSolu.csv
          propname: logS_aq_avg
          smilesname: smiles solute
          plot_title: Aqueous solubility
          plot_propname: log(S)
    outs:
    - path: out/aq/scaffold/ecfp2k-sverad/best.pt
      hash: md5
      md5: fa4a25a006ae61ca03d33a0b9ec199a8
      size: 2783236
    - path: out/aq/scaffold/ecfp2k-sverad/metrics.json
      hash: md5
      md5: 4128367d78280ef7d8a3f404b62aa18d
      size: 646
    - path: out/aq/scaffold/ecfp2k-sverad/model/
      hash: md5
      md5: a252f21e7edb055958d194e6af2770fe.dir
      size: 13901870
      nfiles: 5
  explain_model:
    cmd:
    - mkdir -p out/aq/scaffold/ecfp2k-sverad/viz
    - python3 scripts/explain_ecfp.py
    deps:
    - path: data/aq/scaffold/test.pkl
      hash: md5
      md5: 3382135642c69e3a2e37711596d05a7b
      size: 23902
    - path: out/aq/scaffold/ecfp2k-sverad/best.pt
      hash: md5
      md5: fa4a25a006ae61ca03d33a0b9ec199a8
      size: 2783236
    - path: scripts/explain_ecfp.py
      hash: md5
      md5: 9e65623517451fcfa563b2c81c1b9be9
      size: 16913
    - path: src/explainer.py
      hash: md5
      md5: cc8c2cc7ea7ec45d6c9530b2eab87642
      size: 13040
    - path: src/maskedhead.py
      hash: md5
      md5: e51c7a5310350d0e2607cfac6375cab7
      size: 6830
    params:
      params.yaml:
        head:
          head: sverad
          fit: sklearn
        model:
          model: ecfp2k
          nbits: 2048
          finetune: false
          n_batch: 64
          seed: 42
          n_epochs: 1
        split:
          split: scaffold
          n_splits: 5
          split_frac: 0.9
          data_seed: 42
          scaffold_k: 3
          color: b
          scale: true
        task:
          task: aq
          property: aq
          loader: AqSolDataset
          filepath: /workspace/data/AqueousSolu.csv
          propname: logS_aq_avg
          smilesname: smiles solute
          plot_title: Aqueous solubility
          plot_propname: log(S)
        xai:
          model: ecfp
          xai: ecfp
          mask: false
          sign: None
          save_heat: false
          cmap: div
          topk: 9
    outs:
    - path: out/aq/scaffold/ecfp2k-sverad/attributions.csv
      hash: md5
      md5: 8f3fb02e3013355b47cae2341fa1768a
      size: 173914
    - path: out/aq/scaffold/ecfp2k-sverad/viz
      hash: md5
      md5: d04c8d7edd156aa6d0a49ebb2343a0d9.dir
      size: 32634757
      nfiles: 922
  predict_model:
    cmd:
    - mkdir -p out/aq/scaffold/ecfp2k-sverad/viz
    - python3 scripts/predict_model.py
    - python3 scripts/plot_datasplit.py
    deps:
    - path: data/aq/scaffold/
      hash: md5
      md5: 41780c8f2998975cb8dd67a1be3caeec.dir
      size: 3027946
      nfiles: 12
    - path: out/aq/scaffold/ecfp2k-sverad/best.pt
      hash: md5
      md5: fa4a25a006ae61ca03d33a0b9ec199a8
      size: 2783236
    - path: scripts/plot_datasplit.py
      hash: md5
      md5: 67df0b5de0b523caccd498d817163775
      size: 6155
    - path: scripts/predict_model.py
      hash: md5
      md5: 67636af6c30c07bbbee358505835e83e
      size: 7902
    - path: src/model.py
      hash: md5
      md5: 72ec74221911f70e60259a624f3b3e4d
      size: 23484
    params:
      params.yaml:
        head:
          head: sverad
          fit: sklearn
        model:
          model: ecfp2k
          nbits: 2048
          finetune: false
          n_batch: 64
          seed: 42
          n_epochs: 1
        split:
          split: scaffold
          n_splits: 5
          split_frac: 0.9
          data_seed: 42
          scaffold_k: 3
          color: b
          scale: true
        task:
          task: aq
          property: aq
          loader: AqSolDataset
          filepath: /workspace/data/AqueousSolu.csv
          propname: logS_aq_avg
          smilesname: smiles solute
          plot_title: Aqueous solubility
          plot_propname: log(S)
    outs:
    - path: out/aq/scaffold/ecfp2k-sverad/latent_viz.png
      hash: md5
      md5: eb3ca13fb385c05c1931b288772a0b10
      size: 265966
    - path: out/aq/scaffold/ecfp2k-sverad/parity_plot.png
      hash: md5
      md5: d6ac5950b4d333f390e3ab0f180cfe24
      size: 50993
    - path: out/aq/scaffold/ecfp2k-sverad/predictions.csv
      hash: md5
      md5: c083f24a7c6a858839fa4db321b98c44
      size: 136562
  all:
    cmd:
    - pwd
    - mkdir -p /workspace/final/aq/accurate/ecfp2k-rf/{model,viz}
    - cp -r out/aq/accurate/ecfp2k-rf/ /workspace/final/aq/accurate/
    - cp -r dvc.lock /workspace/final/aq/accurate/ecfp2k-rf/dvc.lock
    - cp -r params.yaml /workspace/final/aq/accurate/ecfp2k-rf/params.yaml
    - python3 scripts/plot_similarity.py
    - python3 scripts/plot_models.py
    - echo "Finished full aq accurate pipeline with ecfp2k-rf"
    deps:
    - path: out/aq/accurate/
      hash: md5
      md5: 8d5a0808ab3a9dbab96812f3a1734f55.dir
      size: 471977191
      nfiles: 1171
    - path: out/aq/accurate/ecfp2k-rf/attributions.csv
      hash: md5
      md5: 3e71684e5d8d57adce5f37b38037fd24
      size: 152812
    - path: out/aq/accurate/ecfp2k-rf/best.pt
      hash: md5
      md5: 4ccc3982460265cac00e4f3506190221
      size: 71288048
    - path: out/aq/accurate/ecfp2k-rf/latent_viz.png
      hash: md5
      md5: cf6b6dc5c357810180b8e37402069718
      size: 241859
    - path: out/aq/accurate/ecfp2k-rf/model
      hash: md5
      md5: a51abec1836b47bc2899bed06dee948d.dir
      size: 356297300
      nfiles: 5
    - path: out/aq/accurate/ecfp2k-rf/parity_plot.png
      hash: md5
      md5: 37431e167b3022aa11fd9b1df6e50b58
      size: 52331
    - path: out/aq/accurate/ecfp2k-rf/predictions.csv
      hash: md5
      md5: 18b49a6f740322b9aaa7ddfd62b7197d
      size: 136727
    - path: out/aq/accurate/ecfp2k-rf/viz
      hash: md5
      md5: 0172b4ed1d6a59c74debc8c6476749be.dir
      size: 43807110
      nfiles: 1156
    - path: scripts/plot_models.py
      hash: md5
      md5: f560f1dee6ae028ebff251d204a7d059
      size: 3997
    - path: scripts/plot_similarity.py
      hash: md5
      md5: e310a494cb520609254e2d7298ffcfbf
      size: 3712
